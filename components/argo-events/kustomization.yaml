---
apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - namespace.yaml
  - https://github.com/argoproj/argo-events/releases/download/v1.9.7/install.yaml
  - https://github.com/argoproj/argo-events/releases/download/v1.9.7/install-validating-webhook.yaml

  # grant the argo-workflows the ability to run workflows in this namespace
  - https://github.com/argoproj/argo-workflows/manifests/namespace-install/argo-server-rbac?ref=v3.5.10
  - https://github.com/argoproj/argo-workflows/manifests/namespace-install/workflow-controller-rbac?ref=v3.5.10

  ## configure webhook Sensor and associated role
  - sensor-workflow-role.yaml
  - workflow-role.yaml

  - configmaps.yaml

  ## copy openstack/cinder-netapp-config to argo-events/netapp-config
  - secret-netapp.yaml

patches:
- target:
    kind: RoleBinding
    name: argo-binding
  path: controller-rb.yaml

- target:
    kind: RoleBinding
    name: argo-server-binding
  path: argo-server-rb.yaml
