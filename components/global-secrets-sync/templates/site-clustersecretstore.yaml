{{- range .Values.sites }}
apiVersion: external-secrets.io/v1
kind: ClusterSecretStore
metadata:
  name: secret-sync-{{ .name }}
spec:
  provider:
    kubernetes:
      remoteNamespace: {{ $.Values.global.targetNamespace }}
      server:
        url: {{ .apiServerURL | quote }}
        caProvider:
          type: Secret
          name: {{ $.Values.global.serviceAccountName }}
          key: ca.crt
          namespace: {{ .namespace }}
      auth:
        token:
          bearerToken:
            name: {{ $.Values.global.serviceAccountName }}
            key: token
            namespace: {{ .namespace }}
---
{{- end }}
