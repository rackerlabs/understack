---
apiVersion: config.projectsveltos.io/v1beta1
kind: ClusterProfile
metadata:
  name: deploy-resources
spec:
  clusterSelector:
    matchLabels:
      understack.rackspace.com/env: dev
  templateResourceRefs:
    - resource:
        apiVersion: v1
        kind: Secret
        name: nautobot-superuser
        namespace: nautobot
      identifier: ExternalSecret
  policyRefs:
    - kind: Secret
      name: test-superuser
      namespace: test-haseeb
---
apiVersion: v1
kind: Secret
metadata:
  name: test-superuser
  namespace: test-haseeb
  annotations:
    projectsveltos.io/template: ok  # add annotation to indicate Sveltos content is a template
type: addons.projectsveltos.io/cluster-profile
stringData:
  secret.yaml: |
    {{ $secret := (getResource "ExternalSecret") }}
    {{ $secret := (chainSetField $secret "metadata.ownerReferences" list) }}
    {{ toYaml $secret }}

#apiVersion: config.projectsveltos.io/v1alpha1
#kind: ClusterProfile
#metadata:
#  name: global-secrets
#spec:
#  clusterSelector:
#    matchLabels:
#      understack.rackspace.com/env: dev
#  helmCharts:
#    - repositoryURL: https://github.com/myorg/platform-secrets.git
#      chartName: db-secrets
#      releaseName: db-secrets
#      version: 0.1.0
#      values: |
#        dbPassword: {{ .Values.dbPassword }}
#    - repositoryURL: https://github.com/myorg/platform-secrets.git
#      chartName: registry-secrets
#      releaseName: registry-secrets
#      version: 0.1.0
#      values: |
#        registryCreds: {{ .Values.registryCreds }}
