---
# Device Types as defined in https://rackerlabs.github.io/understack/design-guide/device-types/

- name: Collect device types from mounted ConfigMap data
  ansible.builtin.set_fact:
    device_types_data: "{{ device_types_data | d([]) + [lookup('file', item.src) | from_yaml] }}"
  with_community.general.filetree: "/runner/data/device-types/"
  when: item.state == "file"
  check_mode: false

- name: Sync manufacturers
  networktocode.nautobot.manufacturer:
    url: "{{ nautobot_url }}"
    token: "{{ nautobot_token }}"
    name: "{{ item }}"
    description: "{{ item }}"
    state: present
  loop: "{{ device_types_data | community.general.json_query('[*].manufacturer') | unique }}"

- name: Loop through device types
  ansible.builtin.include_tasks: device_types.yml
  loop: "{{ device_types_data }}"
  loop_control:
    loop_var: device_type_item
