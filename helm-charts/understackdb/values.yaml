# Default values for understackdb.
# -- name of the database instance
instanceName: mariadb
# -- the namespace where the MariaDB will be created
instanceNamespace: openstack
# -- reference to a Secret containing the root password
rootPasswordSecretKeyRef:
  # -- the name of the Secret
  name: mariadb
  # -- the key in the Secret containing the root password
  key: root-password
  # -- generate determines whether a password should be generated if it's missing
  generate: false

storage:
  # -- the size of the Persistent Volume Claim
  size: 10Gi
  # -- resizeInUseVolumes indicates whether the PVCs can be resized.
  resizeInUseVolumes: true
  waitForVolumeResize: true
  # -- StorageClassName to be used to provision the PVCS. It supersedes the
  # 'StorageClassName' specified in 'VolumeClaimTemplate'.
  storageClassName:
  # @default -- If not provided, the default 'StorageClass' configured in the
  #             cluster is used.
  # storageClassName: default

  # volumeClaimTemplate:
  #   metadata:
  #     name: datadir
  #   spec:
  #     accessModes: [ "ReadWriteOnce" ]
  #     resources:
  #       requests:
  #         storage: 500M


# renovate: image:mariadb
image: mariadb:11.0.3
imagePullPolicy: IfNotPresent

#
# -- stringified contents of my.cnf
# @ignored
myCnf: |
  [mariadb]
  bind-address=*
  default_storage_engine=InnoDB
  binlog_format=row
  innodb_autoinc_lock_mode=2
  max_allowed_packet=256M

# -- the configuration for the prometheus exporter
# @ignored
metrics:
  # -- enabled determines whether the metrics exporter is enabled
  enabled: true
  exporter:
    # -- container image for the metrics exporter
    image: prom/mysqld-exporter:v0.15.1
    # -- port for the metrics exporter
    port: 9104
  passwordSecretKeyRef:
    key: password
    name: mariadb-metrics-password
    generate: true
  serviceMonitor: {}
  username: mariadb-metrics

# -- list of database users
# @default -- users for all Understack components (horizon, ironic, nova, neutron, keystone)
users:
  # users[0].name -- (required) MariaDB username
  - name: glance
    # -- namespace where the `User` record will be created
    # @default --  openstack
    namespace:
    # -- maximum user connections. `0` means unlimited.
    maxUserConnections: 0
    # -- retryInterval
    retryInterval: 5s
    # -- use to specify any additional params
    extraConfig: {}
  - name: horizon
  - name: ironic
  - name: keystone
  - name: neutron
  - name: nova
  - name: placement

# -- list of databases to create
# @default -- databases for all Understack components (horizon, ironic, nova, neutron, keystone)
databases:
  # databases[0].name -- (required) database name
  - name: glance
    # -- namespace that `Database` record will be created in
    # @default -- openstack
    namespace: openstack
    # -- database name override (if different from metadata.name)
    # @default -- value of `.name` is used if unspecified.
    dbname:
    # -- name of the `MariaDB` cluster identifier (`.spec.metadata.name` on MariaDB resource)
    instanceName: mariadb
    # -- database's character set
    characterSet: utf8
    # -- database's collation
    collate: utf8_general_ci
    # -- the interval used to perform retries.
    retryInterval: 5s
    extraConfig: {}            # use to specify any additional params
  - name: horizon
  - name: ironic
  - name: keystone
  - name: neutron
  - name: nova
  - name: nova-api
    dbname: nova_api
  - name: nova-cell0
    dbname: nova_cell0
  - name: placement

# -- list of databases to create
# @default -- grants for all Understack components (horizon, ironic, nova, neutron, keystone)
grants:
  # each grants entry has following format and defaults:
  # grants:
  #   - name: grant_name   (required) the -grant suffix will be appended
  #     namespace: openstack
  #     table: "*"
  #     privileges: [ALL]
  #     grantOption: true
  #     retryInterval: 5s
  # grants[0].name -- (required) partial grant name, the `-grant` suffix will be added.
  - name: glance
    # -- namespace that `Grant` record will be created in
    namespace: openstack
    # -- list of tables that grant is for
    table: "*"
    # -- list of privileges that grant allows
    privileges: [ALL]
    # -- use grant option for this grant
    grantOption: true
    # -- interval used to perform retries.
    retryInterval: 5s
  - name: horizon
  - name: ironic
  - name: keystone
  - name: neutron
  - name: nova
  - name: nova-api
    database: nova_api
    username: nova
  - name: nova-cell0
    username: nova
    database: nova_cell0
  - name: placement
