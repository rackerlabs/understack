apiVersion: argoproj.io/v1alpha1
kind: EventSource
metadata:
  name: k8s-openstack-secrets
  namespace: openstack
spec:
  template:
    serviceAccountName: k8s-openstack-events-secrets
  # Kubernetes resource event sources
  resource:
    keystone-integration-reader-add:
      # monitor deployment resources under openstack namespace
      namespace: openstack
      group: ""
      version: v1
      resource: secrets
      # Event types to listen for (e.g., ADD, UPDATE, DELETE).
      eventTypes:
        - ADD
        - UPDATE
      filter:
        labels:
          - key: understack.rackspace.com/keystone-role
            operation: exists
          - key: understack.rackspace.com/keystone-user
            operation: exists
    keystone-integration-reader-delete:
      # monitor deployment resources under openstack namespace
      namespace: openstack
      group: ""
      version: v1
      resource: secrets
      # Event types to listen for (e.g., ADD, UPDATE, DELETE).
      eventTypes:
        - DELETE
      filter:
        labels:
          - key: understack.rackspace.com/keystone-user
            operation: exists
